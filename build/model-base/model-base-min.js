YUI.add("model-base",function(e,t){function u(){u.superclass.constructor.apply(this,arguments),r.apply(this,arguments)}var n=YUI.namespace("Env.Model"),r=e.AttributeExtras,i=e.Lang,s=e.Array,o=e.Object;e.namespace("Model").Base=e.extend(u,e.BaseCore,{idAttribute:"id",_allowAdHocAttrs:!0,_isYUIModel:!0,initializer:function(e){this.changed={},this.lastChange={},this.lists=[]},destroy:function(e,t){return this._destroy(e,t),u.superclass.destroy.call(this)},generateClientId:function(){return n.lastId||(n.lastId=0),this.constructor.NAME+"_"+(n.lastId+=1)},getAsHTML:function(t){var n=this.get(t);return e.Escape.html(i.isValue(n)?String(n):"")},getAsURL:function(e){var t=this.get(e);return encodeURIComponent(i.isValue(t)?String(t):"")},isModified:function(){return this.isNew()||!o.isEmpty(this.changed)},isNew:function(){return!i.isValue(this.get("id"))},load:function(e,t){var n=this;return typeof e=="function"&&(t=e,e={}),e||(e={}),n.sync("read",e,function(r,i){n._handleRead(r,i,e,t)}),n},parse:function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return null}return t},save:function(e,t){var n=this;return typeof e=="function"&&(t=e,e={}),e||(e={}),n._validate(n.toJSON(),function(r){var i;if(r){t&&t.call(null,r);return}i=n.isNew()?"create":"update",n.sync(i,e,function(r,i){n._handleSave(r,i,e,t)})}),n},set:function(e,t,n){var r={};return r[e]=t,this.setAttrs(r,n)},setAttrs:function(t,n){var r=this.idAttribute,i,s,u,a,f;n||(n={}),f=n._transaction={},r!=="id"&&(t=e.merge(t),o.owns(t,r)?t.id=t[r]:o.owns(t,"id")&&(t[r]=t.id));for(u in t)o.owns(t,u)&&this._setAttr(u,t[u],n);return this._processAttrsTransaction(f,n),this},sync:function(){var e=s(arguments,0,!0).pop();typeof e=="function"&&e()},toJSON:function(){var e=this.getAttrs();return delete e.clientId,delete e.destroyed,delete e.initialized,this.idAttribute!=="id"&&delete e.id,e},undo:function(e,t){var n=this.lastChange,r=this.idAttribute,i={},u;return e||(e=o.keys(n)),s.each(e,function(e){o.owns(n,e)&&(e=e===r?"id":e,u=!0,i[e]=n[e].prevVal)}),u?this.setAttrs(i,t):this},validate:function(e,t){t&&t()},addAttr:function(e,t,n){var r=this.idAttribute,s,o;return r&&e===r&&(s=this._isLazyAttr("id")||this._getAttrCfg("id"),o=t.value===t.defaultValue?null:t.value,i.isValue(o)||(o=s.value===s.defaultValue?null:s.value,i.isValue(o)||(o=i.isValue(t.defaultValue)?t.defaultValue:s.defaultValue)),t.value=o,s.value!==o&&(s.value=o,this._isLazyAttr("id")?this._state.add("id","lazy",s):this._state.add("id","value",o))),u.superclass.addAttr.apply(this,arguments)},_destroy:function(e,t){function r(r){r||s.each(n.lists.concat(),function(t){t.remove(n,e)}),t&&t.apply(null,arguments)}var n=this;typeof e=="function"&&(t=e,e=null),e&&(e.remove||e["delete"])?n.sync("delete",e,r):r()},_parse:function(e){return this.parse(e)},_processAttrsTransaction:function(e,t){var n,r,i,s;if(!o.isEmpty(e)){n=this.changed,s=this.lastChange={};for(i in e)o.owns(e,i)&&(r=e[i],n[i]=r.newVal,s[i]={newVal:r.newVal,prevVal:r.prevVal,src:r.src||null})}},_handleRead:function(e,t,n,r){var i;e||(i=this._parse(t),this.setAttrs(i,n),this.changed={}),r&&r(e,t)},_handleSave:function(e,t,n,r){var i;e||(t&&(i=this._parse(t),this.setAttrs(i,n)),this.changed={}),r&&r(e,t)},_validate:function(e,t){this.validate(e,function(e){i.isValue(e)?t(e):t()})}},{NAME:"model",ATTRS:{clientId:{valueFn:"generateClientId",readOnly:!0},id:{value:null}}}),e.mix(e.Model.Base,r,!1,null,1)},"@VERSION@",{requires:["attribute-extras","base-core","escape","json-parse"]});
